{% extends 'base.html' %}
{% block pagetitle %}
AI Engine
{% endblock pagetitle %}

{% block body %}
<div class="mb-4">
    <div class="container mx-auto p-4">
        <!-- For demo purpose -->
        <div class="row mb-5 text-center text-white">
            <div class="col-lg-10 mx-auto">
                <h1 class="text-4xl font-bold text-green-300 py-4"><b>Detect</b></h1>
                <p class="text-lg font-medium">Let's detect Disease</p>
            </div>
        </div>
        <!-- End -->
        <div class="flex flex-col w-full gap-4">
            <div class="p-5 bg-white shadow-lg rounded-lg h-full">
                <h5 class="font-bold">Why is it necessary to detect disease in plants?</h5>
                <p>Detecting plant diseases early is crucial for maintaining healthy crops and ensuring food security.
                    Early detection allows for timely intervention, which can prevent the spread of disease and minimize
                    crop loss. By identifying diseases before symptoms become severe, farmers can apply targeted
                    treatments, reducing the need for broad-spectrum pesticides and promoting sustainable agriculture.
                    Accurate diagnosis is essential for effective disease management, saving time, resources, and
                    ultimately protecting the environment.
                </p>
            </div>

            <div class="flex gap-4 w-full max-md:flex-col">
                <div class="p-5 bg-white shadow-lg rounded-lg h-full">
                    <img 
                        id="preview-image"
                        src="{{ url_for('static', filename='images/OIP.jpeg') }}" 
                        alt="Plant Image"
                        class="w-[150px] h-[150px] object-cover mx-auto mb-4 rounded-[100px]" 
                    />
                
                    <!-- Default file upload-->
                
                    <form action="/submit" method="POST" enctype="multipart/form-data" id="uploadForm">
                        <div class="mb-4">
                            <input type="file" id="actual-btn" hidden name="file" accept="image/*" />
                            <label for="actual-btn" class="cursor-pointer text-blue-500">Choose File</label>
                            <span id="file-chosen" class="ml-2">No file chosen</span>
                        </div>
                
                        <!-- End -->
                
                        <h6 class="text-center mb-4 text-gray-500">
                            Simply upload your plant's leaf image and press submit.
                        </h6>
                        <div class="mt-4">
                            <h6 class="text-center mb-4 text-gray-500">Or drag and drop your file below:</h6>
                            <div id="drop-area" class="border-dashed border-2 border-gray-400 p-4 text-center">
                                <p>Drag & Drop your file here</p>
                            </div>
                        </div>
                        <button type="submit" class="flex w-full items-center justify-center h-[40px] text-white font-semibold mt-4 bg-green-500 rounded-[20px]">Submit</button>
                    </form>
                </div>

                <div class="p-5 bg-white shadow-lg rounded-lg h-full">
                    <h5 class="font-bold">Prevent Plant Disease: Follow the steps below:</h5>
                    <ol class="list-decimal ml-5">
                        <li>Maintain proper plant spacing to ensure good air circulation.</li>
                        <li>Water plants at the base to avoid wetting the foliage.</li>
                        <li>Use disease-resistant plant varieties.</li>
                        <li>Keep garden tools clean to prevent the spread of pathogens.</li>
                        <li>Remove and dispose of infected plant material promptly.</li>
                        <li>Apply mulch to reduce soil splashing onto leaves.</li>
                        <li>Monitor plants regularly for signs of disease.</li>
                    </ol>
                    <a target="_blank" href="https://www.thespruce.com/prevent-plant-diseases-in-your-garden-2539511" class="underline decoration-2 underline-offset-4 text-green-600 text-center mt-4">
                        More info
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Show chosen file name and image preview
    const actualBtn = document.getElementById('actual-btn');
    const fileChosen = document.getElementById('file-chosen');
    const previewImage = document.getElementById('preview-image');

    actualBtn.addEventListener('change', function() {
        const file = this.files[0];
        fileChosen.textContent = file.name;

        const reader = new FileReader();
        reader.onload = function(e) {
            previewImage.src = e.target.result;
        };
        reader.readAsDataURL(file);
    });

    // Drag and drop functionality
    const dropArea = document.getElementById('drop-area');
    const uploadForm = document.getElementById('uploadForm');

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    dropArea.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
        let dt = e.dataTransfer;
        let files = dt.files;
        handleFiles(files);
    }

    function handleFiles(files) {
        const file = files[0];
        document.getElementById('actual-btn').files = files; // Set files to the input element
        fileChosen.textContent = file.name;

        const reader = new FileReader();
        reader.onload = function(e) {
            previewImage.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }
</script>
{% endblock body %}